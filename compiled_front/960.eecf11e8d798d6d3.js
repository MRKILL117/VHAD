"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[960],{4960:(I,g,s)=>{s.r(g),s.d(g,{MyOrdersModule:()=>J});var d=s(6019),_=s(9845),l=s(7537),u=s(4611),c=s(4684),t=s(1514),p=s(7754),m=s(9299),f=s(6588),Z=s(830),h=s(9853),T=s(754);function O(n,i){if(1&n&&(t.TgZ(0,"div",26),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.AsE(" ",e.name," - ",e.quantity," ")}}function M(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"Cancelar pedido"),t.qZA())}function y(n,i){1&n&&(t.TgZ(0,"span"),t._UZ(1,"i",29),t.qZA())}function A(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2).$implicit;return t.oxw(3).CancelOrder(o)}),t.YNc(1,M,2,0,"span",25),t.YNc(2,y,2,0,"span",25),t.qZA()}if(2&n){const e=t.oxw(5);t.Q6J("disabled",e.loading.cancelling),t.xp6(1),t.Q6J("ngIf",!e.loading.cancelling),t.xp6(1),t.Q6J("ngIf",e.loading.cancelling)}}function C(n,i){if(1&n&&(t.ynx(0),t.YNc(1,A,3,3,"button",27),t.BQk()),2&n){const e=t.oxw().$implicit,r=t.oxw(3);t.xp6(1),t.Q6J("ngIf",r.IsCancellable(e))}}function v(n,i){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t.YNc(5,O,2,2,"div",24),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t.YNc(9,C,2,1,"ng-container",25),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Oqu(t.xi3(3,4,e.creationDate,"dd/MM/YYYY hh:mm a")),t.xp6(3),t.Q6J("ngForOf",e.products),t.xp6(2),t.Oqu(e.status.name),t.xp6(2),t.Q6J("ngIf",!e.isCancelled)}}function b(n,i){if(1&n&&(t.ynx(0),t.YNc(1,v,10,7,"tr",23),t.BQk()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.orders)}}function q(n,i){if(1&n&&(t.ynx(0),t.YNc(1,b,2,1,"ng-container",20),t.BQk()),2&n){const e=t.oxw(),r=t.MAs(39);t.xp6(1),t.Q6J("ngIf",e.orders.length)("ngIfElse",r)}}function x(n,i){1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td",30),t._uU(2," No se encontraron pedidos "),t.qZA(),t.qZA())}function D(n,i){1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td",30),t._UZ(2,"i",31),t.qZA(),t.qZA())}const F=[{path:"",component:(()=>{class n{constructor(e,r,o,a,U,Y){this.http=e,this.role=r,this.toast=o,this.form=a,this.modal=U,this.router=Y,this.timer=null,this.orders=[],this.orderStatuses=[],this.statusToFilter=null,this.startDate="",this.endDate="",this.loading={getting:!1,cancelling:!1},this.user=this.role.GetUser()}ngOnInit(){this.GetOrderStatuses(),this.GetOrders()}IsCancellable(e){return c().tz("America/Mexico_City").diff(c(e.creationDate).tz("America/Mexico_City"),"days",!1),c().tz("America/Mexico_City").diff(c(e.creationDate).tz("America/Mexico_City"),"minutes",!1)<3&&"Entregado"!=e.status.name}GetOrderProductsLength(e){return e.products.reduce((r,o)=>r+o.quantity,0)}SetTrigger(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.GetOrders()},300)}GetOrderStatuses(){this.http.Get("/OrderStatuses").subscribe(e=>{this.orderStatuses=e},e=>{console.error("Error al obtener los estados de ordenes",e)})}GetOrders(){const e=this.statusToFilter?[this.statusToFilter]:[];this.loading.getting=!0,this.http.Get(`/Orders/FilteredByStatusIds/${JSON.stringify(e)}/From/${this.startDate?this.startDate:"*"}/To/${this.endDate?this.endDate:"*"}`).subscribe(r=>{this.orders=r.filter(o=>o.userId==this.user.id).sort((o,a)=>o.creationDate>a.creationDate?-1:o.creationDate<a.creationDate?1:0),this.loading.getting=!1},r=>{this.toast.ShowDefaultDanger("Error al obtener los pedidos"),console.error("Error al obtener ordenes",r),this.loading.getting=!1})}CancelOrder(e){this.loading.cancelling=!0,this.http.Delete(`Orders/${e.id}/Cancel`).subscribe(r=>{this.toast.ShowDefaultInfo("Orden cancelada"),this.loading.cancelling=!1,this.GetOrders()},r=>{console.error("Error al cancelar la orden",r),this.toast.ShowDefaultDanger("Error al cancelar la orden"),this.loading.cancelling=!1})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.O),t.Y36(m.N),t.Y36(f.k),t.Y36(Z.o),t.Y36(h.Z),t.Y36(T.c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-my-orders"]],decls:42,vars:6,consts:[[1,"row","mt-3","mb-4"],[1,"col-12","view-title","d-flex","justify-content-between","align-items-center"],[1,"d-inline-block"],[1,"row","justify-content-end"],[1,"col-12"],[1,"col-12","col-sm-6","col-md-7","col-lg-8","col-xl-9"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"btn","btn-primary",3,"click"],[1,"zmdi","zmdi-delete","zmdi-hc-lg"],["type","date",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"input-group-prepend","input-group-append"],[1,"input-group-text"],[1,"input-group-append"],[1,"col-12","col-sm-6","col-md-5","col-lg-4","col-xl-3"],[1,"form-group"],["bindLabel","name","bindValue","id","placeholder","Filtrar por estatus",3,"items","ngModel","ngModelChange","change"],[1,"row"],[1,"table","table-striped"],[1,"thead-light"],[4,"ngIf","ngIfElse"],["noItemsTable",""],["tableLoading",""],[4,"ngFor","ngForOf"],["class","",4,"ngFor","ngForOf"],[4,"ngIf"],[1,""],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"btn","btn-danger",3,"disabled","click"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin"],["colspan","6",1,"text-center"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-5x"]],template:function(e,r){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3," Mis pedidos "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7,"Filtrar por fecha"),t.qZA(),t.qZA(),t.TgZ(8,"div",5),t.TgZ(9,"div",6),t.TgZ(10,"div",7),t.TgZ(11,"button",8),t.NdJ("click",function(){return r.startDate&&r.SetTrigger(),r.startDate=""}),t._UZ(12,"i",9),t.qZA(),t.qZA(),t.TgZ(13,"input",10),t.NdJ("ngModelChange",function(a){return r.startDate=a})("input",function(){return r.SetTrigger()}),t.qZA(),t.TgZ(14,"div",11),t.TgZ(15,"span",12),t._uU(16,"a"),t.qZA(),t.qZA(),t.TgZ(17,"input",10),t.NdJ("ngModelChange",function(a){return r.endDate=a})("input",function(){return r.SetTrigger()}),t.qZA(),t.TgZ(18,"div",13),t.TgZ(19,"button",8),t.NdJ("click",function(){return r.endDate&&r.SetTrigger(),r.endDate=""}),t._UZ(20,"i",9),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"div",14),t.TgZ(22,"div",15),t.TgZ(23,"ng-select",16),t.NdJ("ngModelChange",function(a){return r.statusToFilter=a})("change",function(){return r.SetTrigger()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(24,"div",17),t.TgZ(25,"div",4),t.TgZ(26,"table",18),t.TgZ(27,"thead",19),t.TgZ(28,"tr"),t.TgZ(29,"th"),t._uU(30,"Fecha"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Productos"),t.qZA(),t.TgZ(33,"th"),t._uU(34,"Estatus"),t.qZA(),t._UZ(35,"th"),t.qZA(),t.qZA(),t.TgZ(36,"tbody"),t.YNc(37,q,2,2,"ng-container",20),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(38,x,3,0,"ng-template",null,21,t.W1O),t.YNc(40,D,3,0,"ng-template",null,22,t.W1O)),2&e){const o=t.MAs(41);t.xp6(13),t.Q6J("ngModel",r.startDate),t.xp6(4),t.Q6J("ngModel",r.endDate),t.xp6(6),t.Q6J("items",r.orderStatuses)("ngModel",r.statusToFilter),t.xp6(14),t.Q6J("ngIf",!r.loading.getting)("ngIfElse",o)}},directives:[l.Fj,l.JJ,l.On,u.w9,d.O5,d.sg],pipes:[d.uU],styles:[""]}),n})()}];let J=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[l.u5,d.ez,u.A0,l.UX,_.Bz.forChild(F)]]}),n})()}}]);