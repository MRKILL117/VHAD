"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[90],{6090:(A,m,i)=>{i.r(m),i.d(m,{OrdersModule:()=>z});var u=i(6019),h=i(9845),g=i(7537),c=i(4611),d=i(6250),t=i(1514),s=i(7754),_=i(9299),T=i(6588),Z=i(830),f=i(9853),O=i(754),v=i(8036);function x(r,a){1&r&&(t.TgZ(0,"span"),t._uU(1,"Atender"),t.qZA())}function b(r,a){1&r&&(t.TgZ(0,"span"),t._UZ(1,"i",31),t.qZA())}function y(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3).$implicit,l=t.oxw(3),p=t.MAs(47);return l.selectedOrder=o,p.show()}),t.YNc(1,x,2,0,"span",28),t.YNc(2,b,2,0,"span",28),t.qZA()}if(2&r){const e=t.oxw(3).$implicit,n=t.oxw(3);t.Q6J("disabled",n.loading.updating),t.xp6(1),t.Q6J("ngIf",!n.loading.updating||n.loading.orderId!=e.id),t.xp6(1),t.Q6J("ngIf",n.loading.updating&&n.loading.orderId==e.id)}}function I(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3).$implicit;return t.oxw(3).router.GoToRoute("/pedidos/"+o.id)}),t.TgZ(1,"span"),t._uU(2,"Ver"),t.qZA(),t.qZA()}if(2&r){const e=t.oxw(6);t.Q6J("disabled",e.loading.updating)}}function q(r,a){if(1&r&&(t.ynx(0),t.YNc(1,y,3,3,"button",29),t.YNc(2,I,3,1,"button",29),t.BQk()),2&r){const e=t.oxw(2).$implicit,n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.sellerId!=n.user.id&&null==e.sellerId),t.xp6(1),t.Q6J("ngIf",e.sellerId==n.user.id)}}function S(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"button",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3).$implicit,l=t.oxw(3),p=t.MAs(49);return l.selectedOrder=o,p.show()}),t.TgZ(1,"span"),t._uU(2,"Cerrar"),t.qZA(),t.qZA()}if(2&r){const e=t.oxw(6);t.Q6J("disabled",e.loading.updating)}}function M(r,a){if(1&r&&(t.ynx(0),t.YNc(1,S,3,1,"button",32),t.BQk()),2&r){const e=t.oxw(2).$implicit,n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.sellerId==n.user.id)}}function F(r,a){if(1&r&&(t.ynx(0),t.YNc(1,q,3,2,"ng-container",28),t.YNc(2,M,2,1,"ng-container",28),t.BQk()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf","enviado"!=(null==e.status||null==e.status.name?null:e.status.name.toLowerCase())),t.xp6(1),t.Q6J("ngIf","enviado"==(null==e.status||null==e.status.name?null:e.status.name.toLowerCase()))}}function U(r,a){if(1&r&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td",27),t.YNc(13,F,3,2,"ng-container",28),t.qZA(),t.qZA()),2&r){const e=a.$implicit,n=t.oxw(3);t.xp6(2),t.Oqu(t.xi3(3,6,e.creationDate,"dd/MM/YYYY hh:mm a")),t.xp6(3),t.Oqu(n.GetOrderProductsLength(e)),t.xp6(2),t.Oqu(e.user.name),t.xp6(2),t.Oqu(e.seller?e.seller.name:"Nadie"),t.xp6(2),t.Oqu(e.status.name),t.xp6(2),t.Q6J("ngIf","entregado"!=(null==e.status||null==e.status.name?null:e.status.name.toLowerCase()))}}function J(r,a){if(1&r&&(t.ynx(0),t.YNc(1,U,14,9,"tr",26),t.BQk()),2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.orders)}}function N(r,a){if(1&r&&(t.ynx(0),t.YNc(1,J,2,1,"ng-container",20),t.BQk()),2&r){const e=t.oxw(),n=t.MAs(43);t.xp6(1),t.Q6J("ngIf",e.orders.length)("ngIfElse",n)}}function w(r,a){1&r&&(t.TgZ(0,"tr"),t.TgZ(1,"td",34),t._uU(2," No hay pedidos disponibles "),t.qZA(),t.qZA())}function D(r,a){1&r&&(t.TgZ(0,"tr"),t.TgZ(1,"td",34),t._UZ(2,"i",35),t.qZA(),t.qZA())}const Y=[{path:"",component:(()=>{class r{constructor(e,n,o,l,p,C){this.http=e,this.role=n,this.toast=o,this.form=l,this.modal=p,this.router=C,this.timer=null,this.selectedOrder=null,this.orders=[],this.orderStatuses=[],this.statusToFilter=null,this.startDate="",this.endDate="",this.loading={orderId:null,getting:!1,updating:!1},this.user=this.role.GetUser()}ngOnInit(){this.GetOrderStatuses(),this.GetOrders()}SetTrigger(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.GetOrders()},300)}GetOrderStatuses(){this.http.Get("/OrderStatuses").subscribe(e=>{this.orderStatuses=e},e=>{console.error("Error al obtener los estados de ordenes",e)})}GetOrders(){const e=this.statusToFilter?[this.statusToFilter]:[];this.loading.getting=!0,this.http.Get(`/Orders/FilteredByStatusIds/${JSON.stringify(e)}/From/${this.startDate?this.startDate:"*"}/To/${this.endDate?this.endDate:"*"}`).subscribe(n=>{this.orders=n.filter(o=>{let l="Admin"==this.role.GetUserRole();return(o.sellerId==this.user.id||!o.sellerId||l)&&!("Entregado"==o.status.name)&&!o.isCancelled}),this.loading.getting=!1},n=>{console.error("Error al obtener ordenes",n),this.loading.getting=!1})}GetOrderProductsLength(e){return e.products.reduce((n,o)=>n+o.quantity,0)}AttendOrder(e){this.loading.orderId=e.id,this.loading.updating=!0,this.http.Patch(`/Orders/${e?e.id:0}/AttendedBy`,{sellerId:this.user?this.user.id:0}).subscribe(n=>{this.modal.CloseModal(),this.loading.updating=!1,this.loading.orderId=null,this.router.GoToRoute(`/pedidos/${e.id}`)},n=>{this.GetOrders(),this.toast.ShowDefaultDanger(506==n.error.error.errorCode?"Ya tienes una orden en proceso":"Error al atender orden"),console.error("Error al atender orden",n),this.loading.updating=!1,this.loading.orderId=null})}CloseOrder(e){this.http.Patch(`Orders/${e?e.id:0}/Close`,{}).subscribe(n=>{this.toast.ShowDefaultSuccess("Orden cerrada correctamente"),this.GetOrders()},n=>{console.error("Error al actualizar la orden",n),this.toast.ShowDefaultDanger("Error al actualizar orden")})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(s.O),t.Y36(_.N),t.Y36(T.k),t.Y36(Z.o),t.Y36(f.Z),t.Y36(O.c))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-orders"]],decls:50,vars:6,consts:[[1,"row","mt-3","mb-4"],[1,"col-12","view-title","d-flex","justify-content-between","align-items-center"],[1,"d-inline-block"],[1,"row","justify-content-end"],[1,"col-12"],[1,"col-12","col-sm-6","col-md-7","col-lg-8","col-xl-9"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"btn","btn-primary",3,"click"],[1,"zmdi","zmdi-delete","zmdi-hc-lg"],["type","date",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"input-group-prepend","input-group-append"],[1,"input-group-text"],[1,"input-group-append"],[1,"col-12","col-sm-6","col-md-5","col-lg-4","col-xl-3"],[1,"form-group"],["bindLabel","name","bindValue","id","placeholder","Filrar por estatus",3,"items","ngModel","ngModelChange","change"],[1,"row"],[1,"table","table-striped"],[1,"thead-light"],[4,"ngIf","ngIfElse"],["noItemsTable",""],["tableLoading",""],[3,"onSuccess"],["confirmIdentity",""],["confirmIdentity2",""],[4,"ngFor","ngForOf"],[1,"text-center"],[4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"zmdi","zmdi-spinner","zmdi-hc-lg","zmdi-hc-spin"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"btn","btn-danger",3,"disabled","click"],["colspan","6",1,"text-center"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin","zmdi-hc-5x"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3," Pedidos "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"label"),t._uU(7,"Filtrar por fecha"),t.qZA(),t.qZA(),t.TgZ(8,"div",5),t.TgZ(9,"div",6),t.TgZ(10,"div",7),t.TgZ(11,"button",8),t.NdJ("click",function(){return n.startDate&&n.SetTrigger(),n.startDate=""}),t._UZ(12,"i",9),t.qZA(),t.qZA(),t.TgZ(13,"input",10),t.NdJ("ngModelChange",function(l){return n.startDate=l})("input",function(){return n.SetTrigger()}),t.qZA(),t.TgZ(14,"div",11),t.TgZ(15,"span",12),t._uU(16,"a"),t.qZA(),t.qZA(),t.TgZ(17,"input",10),t.NdJ("ngModelChange",function(l){return n.endDate=l})("input",function(){return n.SetTrigger()}),t.qZA(),t.TgZ(18,"div",13),t.TgZ(19,"button",8),t.NdJ("click",function(){return n.endDate&&n.SetTrigger(),n.endDate=""}),t._UZ(20,"i",9),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"div",14),t.TgZ(22,"div",15),t.TgZ(23,"ng-select",16),t.NdJ("ngModelChange",function(l){return n.statusToFilter=l})("change",function(){return n.SetTrigger()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(24,"div",17),t.TgZ(25,"div",4),t.TgZ(26,"table",18),t.TgZ(27,"thead",19),t.TgZ(28,"tr"),t.TgZ(29,"th"),t._uU(30,"Fecha"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Productos"),t.qZA(),t.TgZ(33,"th"),t._uU(34,"Cliente"),t.qZA(),t.TgZ(35,"th"),t._uU(36,"Atendido por"),t.qZA(),t.TgZ(37,"th"),t._uU(38,"Estatus"),t.qZA(),t._UZ(39,"th"),t.qZA(),t.qZA(),t.TgZ(40,"tbody"),t.YNc(41,N,2,2,"ng-container",20),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(42,w,3,0,"ng-template",null,21,t.W1O),t.YNc(44,D,3,0,"ng-template",null,22,t.W1O),t.TgZ(46,"app-verify-identity-modal",23,24),t.NdJ("onSuccess",function(){return n.AttendOrder(n.selectedOrder)}),t.qZA(),t.TgZ(48,"app-verify-identity-modal",23,25),t.NdJ("onSuccess",function(){return n.CloseOrder(n.selectedOrder)}),t.qZA()),2&e){const o=t.MAs(45);t.xp6(13),t.Q6J("ngModel",n.startDate),t.xp6(4),t.Q6J("ngModel",n.endDate),t.xp6(6),t.Q6J("items",n.orderStatuses)("ngModel",n.statusToFilter),t.xp6(18),t.Q6J("ngIf",!n.loading.getting)("ngIfElse",o)}},directives:[g.Fj,g.JJ,g.On,c.w9,u.O5,v.S,u.sg],pipes:[u.uU],styles:[""]}),r})()}];let z=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[g.u5,u.ez,c.A0,g.UX,d.t,h.Bz.forChild(Y)]]}),r})()},830:(A,m,i)=>{i.d(m,{o:()=>c});var u=i(7537);function h(d){return t=>t.value&&d!=t.value?{matchstring:d}:null}var g=i(1514);let c=(()=>{class d{constructor(){this.emailRegex=/^[a-zA-Z\xf10-9!#$%&'*+.\-/=?^_`{|}~]{1,}@{1}([a-z]){1,}\.[a-z]{2,}$/,this.emailOrCodeRegex=/(^[0-9]{4}$)|(^[a-zA-Z\xf10-9!#$%&'*+.\-/=?^_`{|}~]{1,}@{1}([a-z]){1,}\.[a-z]{2,}$)/}GetFormControlByName(s,_){return s.controls.hasOwnProperty(_)?s.get(_):null}ResetForm(s){s.reset()}ClearFormControls(s){for(const _ in s.controls)Object.prototype.hasOwnProperty.call(s.controls,_)&&s.removeControl(_)}FormatControlName(s=""){return s.replace(/ /gi,"_").toUpperCase()}OnPasswordChange(s,_,T){const Z=this.GetFormControlByName(s,_),f=this.GetFormControlByName(s,T);null!=Z&&null!=f&&(f.setValidators([u.kI.required,h(Z.value)]),f.updateValueAndValidity({onlySelf:!0}))}}return d.\u0275fac=function(s){return new(s||d)},d.\u0275prov=g.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},9853:(A,m,i)=>{i.d(m,{Z:()=>g});var u=i(1514),h=i(1859);let g=(()=>{class c{constructor(t){this.modalService=t,this.modalRefs=[]}OpenModal(t,s=!0){const _=this.modalService.show(t,{backdrop:"static",keyboard:s});this.modalRefs.push(_)}CloseModal(){this.modalRefs.length&&this.modalRefs.pop().hide()}}return c.\u0275fac=function(t){return new(t||c)(u.LFG(h.tT))},c.\u0275prov=u.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);