"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[159],{3159:(w,f,c)=>{c.r(f),c.d(f,{RecoverPasswordModule:()=>B});var _=c(6019),p=c(9845),i=c(7537),e=c(1514),l=c(7754),u=c(830),a=c(6588);function m(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," C\xf3digo o correo no v\xe1lido "),e.qZA())}function v(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," Favor de ingresar su c\xf3digo o su correo "),e.qZA())}function g(r,s){if(1&r&&(e.TgZ(0,"div",27),e.YNc(1,m,2,0,"span",28),e.YNc(2,v,2,0,"span",28),e.qZA()),2&r){const o=e.oxw(2);let t,n;e.xp6(1),e.Q6J("ngIf",null==(t=o.form.GetFormControlByName(o.recoverAccountForm,"emailOrUsername"))||null==t.errors?null:t.errors.pattern),e.xp6(1),e.Q6J("ngIf",null==(n=o.form.GetFormControlByName(o.recoverAccountForm,"emailOrUsername"))||null==n.errors?null:n.errors.required)}}function d(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"form",20),e.TgZ(1,"div",21),e.TgZ(2,"label",22),e._uU(3,"C\xf3digo o email"),e.qZA(),e.TgZ(4,"div",23),e._UZ(5,"i",24),e.TgZ(6,"input",25),e.NdJ("keyup.enter",function(){return e.CHM(o),e.oxw().SendEmailToRecoverAccount()}),e.qZA(),e.qZA(),e.YNc(7,g,3,2,"div",26),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();let t;e.Q6J("formGroup",o.recoverAccountForm),e.xp6(7),e.Q6J("ngIf",(null==(t=o.form.GetFormControlByName(o.recoverAccountForm,"emailOrUsername"))?null:t.touched)&&(null==(t=o.form.GetFormControlByName(o.recoverAccountForm,"emailOrUsername"))?null:t.errors))}}function C(r,s){1&r&&(e.TgZ(0,"span"),e._uU(1,"Recuperar cuenta"),e.qZA())}function h(r,s){1&r&&e._UZ(0,"i",33)}function Z(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){return e.CHM(o),e.oxw().SendEmailToRecoverAccount()}),e.YNc(1,C,2,0,"span",31),e.TgZ(2,"span"),e.YNc(3,h,1,0,"i",32),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();e.Q6J("disabled",o.loading.sendingEmail),e.xp6(1),e.Q6J("ngIf",!o.loading.sendingEmail),e.xp6(2),e.Q6J("ngIf",o.loading.sendingEmail)}}function P(r,s){1&r&&(e.TgZ(0,"span"),e._uU(1,"Verificar PIN"),e.qZA())}function x(r,s){1&r&&e._UZ(0,"i",33)}function T(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){return e.CHM(o),e.oxw().CheckIfVerificationCodeIsValid()}),e.YNc(1,P,2,0,"span",31),e.TgZ(2,"span"),e.YNc(3,x,1,0,"i",32),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();e.Q6J("disabled",o.loading.verifyingCode),e.xp6(1),e.Q6J("ngIf",!o.loading.verifyingCode),e.xp6(2),e.Q6J("ngIf",o.loading.verifyingCode)}}function F(r,s){1&r&&(e.TgZ(0,"span"),e._uU(1,"Reestablecer contrase\xf1a"),e.qZA())}function A(r,s){1&r&&e._UZ(0,"i",33)}function N(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){return e.CHM(o),e.oxw().ResetPassword()}),e.YNc(1,F,2,0,"span",31),e.TgZ(2,"span"),e.YNc(3,A,1,0,"i",32),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();e.Q6J("disabled",o.loading.restoringPassword),e.xp6(1),e.Q6J("ngIf",!o.loading.restoringPassword),e.xp6(2),e.Q6J("ngIf",o.loading.restoringPassword)}}function I(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," PIN inv\xe1lido "),e.qZA())}function R(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," Ingrese el PIN que se envi\xf3 a su correo "),e.qZA())}function y(r,s){if(1&r&&(e.TgZ(0,"div",27),e.YNc(1,I,2,0,"span",28),e.YNc(2,R,2,0,"span",28),e.qZA()),2&r){const o=e.oxw(3);let t,n;e.xp6(1),e.Q6J("ngIf",null==(t=o.form.GetFormControlByName(o.verificationCodeForm,"verificationCode"))||null==t.errors?null:t.errors.pattern),e.xp6(1),e.Q6J("ngIf",null==(n=o.form.GetFormControlByName(o.verificationCodeForm,"verificationCode"))||null==n.errors?null:n.errors.required)}}function q(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"form",20),e.TgZ(1,"div",21),e.TgZ(2,"label",34),e._uU(3,"PIN"),e.qZA(),e.TgZ(4,"div",23),e._UZ(5,"i",35),e.TgZ(6,"input",36),e.NdJ("keyup.enter",function(){return e.CHM(o),e.oxw(2).CheckIfVerificationCodeIsValid()}),e.qZA(),e.qZA(),e.YNc(7,y,3,2,"div",26),e.qZA(),e.qZA()}if(2&r){const o=e.oxw(2);let t;e.Q6J("formGroup",o.verificationCodeForm),e.xp6(7),e.Q6J("ngIf",(null==(t=o.form.GetFormControlByName(o.verificationCodeForm,"verificationCode"))?null:t.touched)&&(null==(t=o.form.GetFormControlByName(o.verificationCodeForm,"verificationCode"))?null:t.errors))}}function b(r,s){if(1&r&&e.YNc(0,q,8,2,"form",12),2&r){const o=e.oxw(),t=e.MAs(29);e.Q6J("ngIf",!o.isVerificationCodeValid)("ngIfElse",t)}}function k(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," Escriba una contrase\xf1a "),e.qZA())}function J(r,s){if(1&r&&(e.TgZ(0,"div",27),e.YNc(1,k,2,0,"span",28),e.qZA()),2&r){const o=e.oxw(2);let t;e.xp6(1),e.Q6J("ngIf",null==(t=o.form.GetFormControlByName(o.resetPasswordForm,"password"))||null==t.errors?null:t.errors.required)}}function U(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," Confirme la contrase\xf1a "),e.qZA())}function E(r,s){1&r&&(e.TgZ(0,"span",29),e._uU(1," Las contrase\xf1as no coinciden "),e.qZA())}function Y(r,s){if(1&r&&(e.TgZ(0,"div",27),e.YNc(1,U,2,0,"span",28),e.YNc(2,E,2,0,"span",28),e.qZA()),2&r){const o=e.oxw(2);let t,n;e.xp6(1),e.Q6J("ngIf",null==(t=o.form.GetFormControlByName(o.resetPasswordForm,"confirmPassword"))||null==t.errors?null:t.errors.required),e.xp6(1),e.Q6J("ngIf",null==(n=o.form.GetFormControlByName(o.resetPasswordForm,"confirmPassword"))||null==n.errors?null:n.errors.matchstring)}}function S(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"form",20),e.TgZ(1,"div",21),e.TgZ(2,"label",37),e._uU(3,"Contrase\xf1a"),e.qZA(),e.TgZ(4,"input",38),e.NdJ("input",function(){e.CHM(o);const n=e.oxw();return n.form.OnPasswordChange(n.resetPasswordForm,"password","confirmPassword")})("keyup.enter",function(){return e.CHM(o),e.oxw().ResetPassword()}),e.qZA(),e.YNc(5,J,2,1,"div",26),e.qZA(),e.TgZ(6,"div",21),e.TgZ(7,"label",39),e._uU(8,"Confirmar contrase\xf1a"),e.qZA(),e.TgZ(9,"input",40),e.NdJ("keyup.enter",function(){return e.CHM(o),e.oxw().ResetPassword()}),e.qZA(),e.YNc(10,Y,3,2,"div",26),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();let t,n;e.Q6J("formGroup",o.resetPasswordForm),e.xp6(5),e.Q6J("ngIf",(null==(t=o.form.GetFormControlByName(o.resetPasswordForm,"password"))?null:t.touched)&&(null==(t=o.form.GetFormControlByName(o.resetPasswordForm,"password"))?null:t.errors)),e.xp6(5),e.Q6J("ngIf",(null==(n=o.form.GetFormControlByName(o.resetPasswordForm,"confirmPassword"))?null:n.touched)&&(null==(n=o.form.GetFormControlByName(o.resetPasswordForm,"confirmPassword"))?null:n.errors))}}const Q=[{path:"",component:(()=>{class r{constructor(o,t,n,G){this.http=o,this.form=t,this.toast=n,this.router=G,this.mailSent=!1,this.userEmail="",this.isVerificationCodeValid=!1,this.loading={sendingEmail:!1,verifyingCode:!1,restoringPassword:!1},this.recoverAccountForm=new i.cw({emailOrUsername:new i.NI("",[i.kI.required,i.kI.pattern(this.form.emailOrCodeRegex)])}),this.verificationCodeForm=new i.cw({verificationCode:new i.NI("",[i.kI.required,i.kI.pattern(/(^[0-9]{6}$)/)])}),this.resetPasswordForm=new i.cw({password:new i.NI("",[i.kI.required]),confirmPassword:new i.NI("",[i.kI.required])})}ngOnInit(){}SendEmailToRecoverAccount(){if(!this.recoverAccountForm.valid)return this.toast.ShowDefaultWarning("Favor de llenar todos los campos","Formulario incompleto"),void this.recoverAccountForm.markAllAsTouched();this.loading.sendingEmail=!0,this.http.Post("/Accounts/SendRestorePasswordEmail",this.recoverAccountForm.value).subscribe(o=>{this.toast.ShowDefaultSuccess("Verifique su correo","Codigo de verificacion enviado"),this.userEmail=o.email,this.mailSent=!0,this.loading.sendingEmail=!1},o=>{415==o.error.error.errorCode?this.toast.ShowDefaultDanger("Administradores no pueden reestablecer su contrase\xf1a","Admin detectado"):this.toast.ShowDefaultDanger("Correo o c\xf3digo incorrecto","Error al recuperar cuenta"),console.error("Error al hacer login",o),this.loading.sendingEmail=!1})}CheckIfVerificationCodeIsValid(){if(!this.verificationCodeForm.valid)return this.toast.ShowDefaultWarning("Favor de ingresar el PIN","Formulario incompleto"),void this.verificationCodeForm.markAllAsTouched();this.loading.verifyingCode=!0,this.http.Post("/Accounts/VerifyPIN",this.verificationCodeForm.value).subscribe(o=>{if(this.userEmail!=o.email)return this.toast.ShowDefaultDanger("El PIN no coincide"),void(this.loading.verifyingCode=!1);this.isVerificationCodeValid=!0,this.loading.verifyingCode=!1},o=>{console.error("Error al verificar PIN",o),this.toast.ShowDefaultDanger("Error al verificar PIN"),this.loading.verifyingCode=!1})}ResetPassword(){if(!this.resetPasswordForm.valid)return this.toast.ShowDefaultWarning("Favor de llenar los cmapos correctamente","Formulario incompleto"),void this.resetPasswordForm.markAllAsTouched();this.loading.restoringPassword=!0,this.http.Patch("/Accounts/RestorePassword",{verificationCode:this.verificationCodeForm.value.verificationCode,newPassword:this.resetPasswordForm.value.password}).subscribe(t=>{this.toast.ShowDefaultSuccess("Contrase\xf1a restaurada correctamente"),this.BackToLogin(),this.loading.restoringPassword=!1},t=>{this.toast.ShowDefaultDanger("Error al restaurar su contrase\xf1a"),this.loading.restoringPassword=!1})}BackToLogin(){this.router.navigate(["/login"])}GetRegisterRoute(){return`${this.http.hostBaseUrl}/registro`}GetLoginRoute(){return`${this.http.hostBaseUrl}/login`}}return r.\u0275fac=function(o){return new(o||r)(e.Y36(l.O),e.Y36(u.o),e.Y36(a.k),e.Y36(p.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-recover-password"]],decls:30,vars:7,consts:[[1,"full-screen"],[1,"vertical-center"],[1,"w-100"],[1,"row","justify-content-center"],[1,"col-12","col-md-8","col-lg-6"],[1,"card"],[1,"card-header"],[1,"d-flex",2,"height","33px"],[1,"d-flex","h-100","align-items-center","mr-2","clickeable",3,"click"],[1,"zmdi","zmdi-arrow-left","zmdi-hc-lg"],[1,"card-title","d-inline-block","mb-0"],[1,"card-body"],[3,"formGroup",4,"ngIf","ngIfElse"],[1,"text-center"],[3,"href"],[1,"text-center","mt-2"],[1,"card-footer","text-right"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["verificationCodeCard",""],["resetPasswordCard",""],[3,"formGroup"],[1,"form-group"],["for","emailOrUsername"],[1,"input-container"],[1,"input-icon","zmdi","zmdi-lock"],["type","text","formControlName","emailOrUsername","placeholder","Ingrese su c\xf3digo o su email",1,"form-control",3,"keyup.enter"],["class","error-messages",4,"ngIf"],[1,"error-messages"],["class","d-block",4,"ngIf"],[1,"d-block"],[1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","zmdi zmdi-spinner zmdi-hc-spin",4,"ngIf"],[1,"zmdi","zmdi-spinner","zmdi-hc-spin"],["for","verificationCode"],[1,"input-icon","zmdi","zmdi-dialpad"],["type","text","formControlName","verificationCode","placeholder","Ingrese el PIN que se le envi\xf3 a su correo",1,"form-control",3,"keyup.enter"],["for","password"],["type","password","placeholder","Ingrese su nueva contrase\xf1a","formControlName","password",1,"form-control",3,"input","keyup.enter"],["for","confirmPassword"],["type","password","placeholder","Confirme su contrase\xf1a","formControlName","confirmPassword",1,"form-control",3,"keyup.enter"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"div",3),e.TgZ(4,"div",4),e.TgZ(5,"div",5),e.TgZ(6,"div",6),e.TgZ(7,"div",7),e.TgZ(8,"div",8),e.NdJ("click",function(){return t.BackToLogin()}),e._UZ(9,"i",9),e.qZA(),e.TgZ(10,"h3",10),e._uU(11,"Recuperar cuenta"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(12,"div",11),e.YNc(13,d,8,2,"form",12),e.TgZ(14,"div",13),e._uU(15," \xbfNo tienes cuenta? "),e.TgZ(16,"a",14),e._uU(17,"Registrate aqu\xed"),e.qZA(),e.qZA(),e.TgZ(18,"div",15),e._uU(19," \xbfYa tienes cuenta? "),e.TgZ(20,"a",14),e._uU(21,"Inicia sesi\xf3n aqu\xed"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",16),e.YNc(23,Z,4,3,"button",17),e.YNc(24,T,4,3,"button",17),e.YNc(25,N,4,3,"button",17),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(26,b,1,2,"ng-template",null,18,e.W1O),e.YNc(28,S,11,3,"ng-template",null,19,e.W1O)),2&o){const n=e.MAs(27);e.xp6(13),e.Q6J("ngIf",!t.mailSent)("ngIfElse",n),e.xp6(3),e.s9C("href",t.GetRegisterRoute(),e.LSH),e.xp6(4),e.s9C("href",t.GetLoginRoute(),e.LSH),e.xp6(3),e.Q6J("ngIf",!t.mailSent),e.xp6(1),e.Q6J("ngIf",t.mailSent&&!t.isVerificationCodeValid),e.xp6(1),e.Q6J("ngIf",t.isVerificationCodeValid)}},directives:[_.O5,i._Y,i.JL,i.sg,i.Fj,i.JJ,i.u],styles:[".card[_ngcontent-%COMP%]{background-color:#fff8;box-shadow:none!important}"]}),r})()}];let B=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[i.u5,_.ez,i.UX,p.Bz.forChild(Q)]]}),r})()},830:(w,f,c)=>{c.d(f,{o:()=>e});var _=c(7537);function p(l){return u=>u.value&&l!=u.value?{matchstring:l}:null}var i=c(1514);let e=(()=>{class l{constructor(){this.emailRegex=/^[a-zA-Z\xf10-9!#$%&'*+.\-/=?^_`{|}~]{1,}@{1}([a-z]){1,}\.[a-z]{2,}$/,this.emailOrCodeRegex=/(^[0-9]{4}$)|(^[a-zA-Z\xf10-9!#$%&'*+.\-/=?^_`{|}~]{1,}@{1}([a-z]){1,}\.[a-z]{2,}$)/}GetFormControlByName(a,m){return a.controls.hasOwnProperty(m)?a.get(m):null}ResetForm(a){a.reset()}ClearFormControls(a){for(const m in a.controls)Object.prototype.hasOwnProperty.call(a.controls,m)&&a.removeControl(m)}FormatControlName(a=""){return a.replace(/ /gi,"_").toUpperCase()}OnPasswordChange(a,m,v){const g=this.GetFormControlByName(a,m),d=this.GetFormControlByName(a,v);null!=g&&null!=d&&(d.setValidators([_.kI.required,p(g.value)]),d.updateValueAndValidity({onlySelf:!0}))}}return l.\u0275fac=function(a){return new(a||l)},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()}}]);