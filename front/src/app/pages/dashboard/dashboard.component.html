<div class="content-with-footer">
    <div class="search-header">
        <div class="row justify-content-between">
            <div class="col-5 col-sm-4 col-md-3 col-lg-2">
                <div class="form-group d-flex h-100 align-items-center justify-content-center clickeable"
                id="categoriesFilterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="zmdi zmdi-caret-down zmdi-hc-2x mr-2"></i>
                    <span style="font-size: 1.2rem; font-weight: bold;">Categorías</span>
                </div>
                <div class="dropdown-menu" (click)="$event.stopPropagation();" aria-labelledby="categoriesFilterDropdown">
                    <div class="menu-list">
                        <ng-container *ngFor="let category of categories">
                            <div class="menu-item clickeable" (click)="categoryInput.click()">
                                <input type="checkbox" #categoryInput (change)="OnCategoryFilterChange($event, category)">
                                <span class="pl-2">{{category.name}}</span>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </div>
            <div class="col-7 col-sm-8 col-md-9 col-lg-10">
                <div class="form-group d-flex h-100 align-items-center">
                    <div class="input-container w-100">
                        <i class="input-icon zmdi zmdi-search"></i>
                        <input class="form-control" type="text" placeholder="¿Qué está buscando?"
                        maxlength="30" [(ngModel)]="txtToFilter" (input)="SetSearchTrigger()">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <ng-container *ngIf="!loading.getting; else bigLoading">
        <div class="row mt-3" *ngIf="products?.length; else noItems">
            <!-- offers -->
            <div class="col-12 col-sm-6 col-lg-4 col-xl-3 mb-3" *ngFor="let product of products">
                <div class="card pt-0 px-0 clickeable">
                    <div class="card-header p-0 mb-2">
                        <img *ngIf="product?.images?.length" class="card-image"
                        [src]="http.apiBaseUrl + product.images[0].partialURL" [alt]="product.images[0].name">
                        <img *ngIf="product.activeOffer" style="position: absolute; top: 3px; right: 5px; height: 7vh; min-height: 60px;" src="assets/icons/offer-icon.png">
                    </div>
                    <div class="card-body py-0">
                        <div class="product-name">
                            {{product.name}}
                        </div>
                        <div class="product-description position-relative" style="font-size: 1rem;">
                            {{product.description}}
                            <div class="product-description-gradient">
                            </div>
                        </div>
                        <div class="text-right product-category">
                            {{product.category?.name}}
                        </div>
                    </div>
                    <div class="card-footer py-0 text-right">
                        <div class="d-flex justify-content-between h-100 align-items-end">
                            <div *ngIf="product.activeOffer" style="font-size: 1.6rem; font-weight: bold; color: black;">
                                <div class="text-left" style="font-size: 1.2rem; text-decoration: line-through; color: #888;">
                                    ${{product.price | number:"1.2-2"}}
                                </div>
                                <div>
                                    ${{product.offerPrice | number:"1.2-2"}}
                                </div>
                            </div>
                            <div *ngIf="!product.activeOffer" style="font-size: 1.6rem; font-weight: bold; color: black; margin-top: 1.8rem;">
                                <div>
                                    ${{product.price | number:"1.2-2"}}
                                </div>
                            </div>
                            <button class="btn btn-warning">
                                <span>
                                    Añadir
                                </span>
                                <i class="zmdi zmdi-shopping-cart ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>

<ng-template #bigLoading>
    <div class="row">
        <div class="col-12 col-flex-center">
            <i class="zmdi zmdi-spinner zmdi-hc-5x zmdi-hc-spin"></i>
        </div>
    </div>
</ng-template>

<ng-template #noItems>
    <div class="w-100 text-center" style="font-size: 1.5rem; font-weight: bold;">
        <span *ngIf="txtToFilter || categoryToFilter">No se encontraron coincidencias para "{{txtToFilter}}"</span>
    </div>
</ng-template>

<app-footer *ngIf="!loading.getting"></app-footer>